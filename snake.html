<!DOCTYPE html>
<html>
<head>
  <title>Snake Game</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      overflow: hidden;
    }
    canvas {
      display: block;
      margin: auto;
      background: #111;
    }
    #overlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      color: white;
      font-size: 3em;
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(0,0,0,0.7);
      flex-direction: column;
      z-index: 1;
      display: none;
    }
    button {
      font-size: 1em;
      padding: 10px 20px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
<div id="overlay">
  <div id="message">You Died!</div>
  <button onclick="restartGame()">Try Again</button>
</div>
<canvas id="game"></canvas>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const gridSize = 20;
const tileCountX = Math.floor(canvas.width / gridSize);
const tileCountY = Math.floor(canvas.height / gridSize);

let snake = [{x: 10, y: 10}];
let direction = {x: 1, y: 0};
let score = 0;
let speed = 150;
let lastUpdate = 0;
let overlay = document.getElementById("overlay");

function gameLoop(timestamp) {
  if (timestamp - lastUpdate < speed) {
    requestAnimationFrame(gameLoop);
    return;
  }
  lastUpdate = timestamp;

  update();
  draw();
  requestAnimationFrame(gameLoop);
}

function update() {
  score++;
  if (score % 100 === 0 && speed > 50) speed -= 5;

  const head = {x: (snake[0].x + direction.x + tileCountX) % tileCountX,
                y: (snake[0].y + direction.y + tileCountY) % tileCountY};

  if (snake.some(segment => segment.x === head.x && segment.y === head.y)) {
    overlay.style.display = "flex";
    return;
  }

  snake.unshift(head);
  snake.pop();
}

function draw() {
  ctx.fillStyle = "#111";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = "lime";
  for (let segment of snake) {
    ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize, gridSize);
  }

  ctx.fillStyle = "white";
  ctx.font = "20px sans-serif";
  ctx.fillText("Score: " + score, 10, 30);
}

window.addEventListener("keydown", e => {
  if (e.key === "ArrowUp" && direction.y === 0) direction = {x: 0, y: -1};
  if (e.key === "ArrowDown" && direction.y === 0) direction = {x: 0, y: 1};
  if (e.key === "ArrowLeft" && direction.x === 0) direction = {x: -1, y: 0};
  if (e.key === "ArrowRight" && direction.x === 0) direction = {x: 1, y: 0};
});

function restartGame() {
  snake = [{x: 10, y: 10}];
  direction = {x: 1, y: 0};
  score = 0;
  speed = 150;
  overlay.style.display = "none";
}

requestAnimationFrame(gameLoop);
</script>
</body>
</html>
